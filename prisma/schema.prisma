generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Patient {
  id             String       @id @default(cuid())
  userId         String
  nome           String
  dataNascimento DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  dailyNotes     DailyNote[]
  medications    Medication[]

  @@index([userId])
  @@map("patients")
}

model DailyNote {
  id             String       @id @default(cuid())
  data           DateTime     @default(now())
  horaDormiu     String?
  horaAcordou    String?
  humor          Int?
  detalhesExtras String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  patientId      String
  tags           String[]     @default([])
  patient        Patient      @relation(fields: [patientId], references: [id], onDelete: Cascade)
  hourlyNotes    HourlyNote[]

  @@index([patientId])
  @@index([data])
  @@map("daily_notes")
}

model HourlyNote {
  id          String    @id @default(cuid())
  hora        String
  descricao   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  dailyNoteId String
  dailyNote   DailyNote @relation(fields: [dailyNoteId], references: [id], onDelete: Cascade)

  @@index([dailyNoteId])
  @@map("hourly_notes")
}

model Medication {
  id          String              @id @default(cuid())
  nome        String
  dosagem     String
  frequencia  String
  observacoes String?
  ativo       Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  patientId   String
  patient     Patient             @relation(fields: [patientId], references: [id], onDelete: Cascade)
  changes     MedicationChange[]

  @@index([patientId])
  @@index([ativo])
  @@map("medications")
}

model MedicationChange {
  id           String     @id @default(cuid())
  campo        String     // nome, dosagem, frequencia, observacoes, ativo
  valorAnterior String?
  valorNovo    String
  motivo       String?
  createdAt    DateTime   @default(now())
  medicationId String
  medication   Medication @relation(fields: [medicationId], references: [id], onDelete: Cascade)

  @@index([medicationId])
  @@index([createdAt])
  @@map("medication_changes")
}
