// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Modelo de Paciente
model Patient {
  id             String      @id @default(cuid())
  userId         String      // ID do usuário autenticado no Supabase
  nome           String
  dataNascimento DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  // Relações
  dailyNotes     DailyNote[]

  @@map("patients")
  @@index([userId])
}

// Modelo de Anotação Diária
model DailyNote {
  id             String        @id @default(cuid())
  data           DateTime      @default(now())
  horaDormiu     String?       // Formato: "22:30"
  horaAcordou    String?       // Formato: "07:00"
  humor          Int?          // Escala de 1 a 5
  detalhesExtras String?       @db.Text
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relações
  patientId      String
  patient        Patient       @relation(fields: [patientId], references: [id], onDelete: Cascade)
  hourlyNotes    HourlyNote[]
  tags           DailyNoteTag[]

  @@map("daily_notes")
  @@index([patientId])
  @@index([data])
}

// Modelo de Anotação por Hora
model HourlyNote {
  id          String    @id @default(cuid())
  hora        String    // Formato: "14:30"
  descricao   String    @db.Text
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relações
  dailyNoteId String
  dailyNote   DailyNote @relation(fields: [dailyNoteId], references: [id], onDelete: Cascade)

  @@map("hourly_notes")
  @@index([dailyNoteId])
}

// Modelo de Tag
model Tag {
  id          String         @id @default(cuid())
  nome        String         @unique
  cor         String         @default("#3B82F6") // Cor em hexadecimal, default azul
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  // Relações
  dailyNotes  DailyNoteTag[]

  @@map("tags")
}

// Tabela de junção para relacionamento many-to-many entre DailyNote e Tag
model DailyNoteTag {
  dailyNoteId String
  tagId       String

  dailyNote   DailyNote @relation(fields: [dailyNoteId], references: [id], onDelete: Cascade)
  tag         Tag       @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([dailyNoteId, tagId])
  @@map("daily_note_tags")
  @@index([dailyNoteId])
  @@index([tagId])
}
